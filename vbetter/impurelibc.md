the C library is *impure*
====

# The problem

glibc, like many standard C library implementations, can be seen as the union of two libraries:
* the actual C library which provides high level services, using the system calls
    of the underlying kernel,
* the interface library to the kernel, which dispatches the system call
    to the kernel and retrieves the results.

Functions like `strcat` or `snprintf` are library functions, while `read`, `fork` or `socket`
are wrappers of system calls. The two different kinds of function are even described in
ditterent sections of the online manuals. Library function cen be found in `man 3` while
system call wrappers appear in `man 2`.

A pure C library is a library providing only the former item.

It is useful to have a pure C library when a process needs to use self-virtualization.

*Process self-virtualization* is a technique that allows the reuse of existing code,
	libraries or applications, in different environments,
	Processes using *self-virtualization* can re-define the behavior of their system calls.

In view-os, for example, using self-virtualization it is possible to run modules like umfuseext2 
further virtualizing the system calls generated by the ext2fs and glibc libraries.
In this way the file system image can be something generated on-the-fly instead of a 
file as requested by the ext2fs design.
This is just an example. Many other applications can be found using coding creativity.

# Workaround

`purelibc` is an overlay library which works _above_ glibc,  providing an 
approximation of a C pure library using dynamic library symbol overriding.

It is incomplete and some functionnalities had to be reimplemented.
For the `stdio` file functions `purelibc` uses `fopen-cookies`.

# Please

...help us to provide a complete support for purelibc as a feature of a C library.
We proposed a proof-of-concept patch (for x86\_64 only). 
Maybe the best way to implement a purelibc in glibc is to add an arch tree.
In the arch *pure* system calls are implemented as function calls to a system
call implementation function.

# Links

* [purelibc](https://github.com/virtualsquare/purelibc)
* [proof-of-concept patch](https://patchwork.ozlabs.org/patch/804510/)

